  <ion-header [translucent]="true">
    <ion-toolbar>
      <ion-title>Clientes</ion-title>
    </ion-toolbar>
  </ion-header>

  <ion-content [fullscreen]="true" class="ion-padding">
    <ion-header collapse="condense">
      <ion-toolbar>
        <ion-title size="large">Clientes</ion-title>
      </ion-toolbar>
    </ion-header>

    <!-- üîé B√∫squeda -->
    <ion-searchbar
      placeholder="Buscar por nombre, apellido, correo o tel√©fono..."
      (ionInput)="buscarClientes($event)"
      (ionClear)="limpiarBusqueda()"
      [value]="termino"
      animated
      clear-icon="close-circle">
    </ion-searchbar>

    <!-- Contador -->
    <div *ngIf="termino" class="ion-padding-start ion-padding-bottom">
      <ion-text color="primary">
        {{ clientesFiltrados.length }} resultado(s)
      </ion-text>
    </div>

    <!-- Lista -->
    <ion-list>
      <ion-item-sliding *ngFor="let cliente of clientesFiltrados">
        <ion-card>
          <ion-card-header>
            <ion-item lines="none">
              <!-- Avatar -->
              <ion-avatar slot="start">
                <ion-icon name="person-circle" size="large"></ion-icon>
              </ion-avatar>

              <!-- Informaci√≥n -->
              <ion-label>
                <h2><strong>{{cliente.Nombre}} {{cliente.Apellido}}</strong></h2>
                <p><strong>Correo:</strong> {{cliente.Correo}}</p>
                <p><strong>Tel√©fono:</strong> {{cliente.Telefono}}</p>
                <p><strong>Direcci√≥n:</strong> {{cliente.Direccion}}</p>
              </ion-label>
            </ion-item>
          </ion-card-header>

          <ion-card-content>
            <ion-grid>
              <ion-row>
                <ion-col size="4">
                  <ion-button expand="block" color="primary"
                    [routerLink]="['/detalle-clientes', cliente.IdCliente]">
                    <ion-icon name="eye-outline" slot="start"></ion-icon>
                    Ver
                  </ion-button>
                </ion-col>

                <ion-col size="4">
                  <ion-button expand="block" color="warning" (click)="abrirEditar(cliente)">
                    <ion-icon name="create-outline" slot="start"></ion-icon>
                    Editar
                  </ion-button>
                </ion-col>

                <ion-col size="4">
                  <ion-button expand="block" color="danger" (click)="eliminarCliente(cliente)">
                    <ion-icon name="trash-outline" slot="start"></ion-icon>
                    Eliminar
                  </ion-button>
                </ion-col>
              </ion-row>
            </ion-grid>
          </ion-card-content>
        </ion-card>
      </ion-item-sliding>
    </ion-list>

    <!-- Modal editar -->
    <ion-modal [isOpen]="modalAbierto" (didDismiss)="cerrarModal()">
      <ng-template>
        <ion-header>
          <ion-toolbar>
            <ion-title>Editar Cliente</ion-title>
            <ion-buttons slot="end">
              <ion-button (click)="cerrarModal()">Cerrar</ion-button>
            </ion-buttons>
          </ion-toolbar>
        </ion-header>

        <ion-content class="ion-padding">
          <form [formGroup]="formCliente" (ngSubmit)="guardarEdicion()">
            <ion-item>
              <ion-label position="stacked">Nombre</ion-label>
              <ion-input formControlName="Nombre"></ion-input>
            </ion-item>
            <ion-note color="danger" *ngIf="formCliente.get('Nombre')?.touched && formCliente.get('Nombre')?.invalid">
              El nombre es obligatorio.
            </ion-note>

            <ion-item>
              <ion-label position="stacked">Apellido</ion-label>
              <ion-input formControlName="Apellido"></ion-input>
            </ion-item>
            <ion-note color="danger" *ngIf="formCliente.get('Apellido')?.touched && formCliente.get('Apellido')?.invalid">
              El apellido es obligatorio.
            </ion-note>

            <ion-item>
              <ion-label position="stacked">Correo</ion-label>
              <ion-input type="email" formControlName="Correo"></ion-input>
            </ion-item>
            <ion-note color="danger" *ngIf="formCliente.get('Correo')?.touched && formCliente.get('Correo')?.invalid">
              Correo inv√°lido.
            </ion-note>

            <ion-item>
              <ion-label position="stacked">Tel√©fono</ion-label>
              <ion-input formControlName="Telefono"></ion-input>
            </ion-item>

            <ion-item>
              <ion-label position="stacked">Direcci√≥n</ion-label>
              <ion-textarea formControlName="Direccion" autoGrow="true"></ion-textarea>
            </ion-item>

            <ion-row class="ion-margin-top">
              <ion-col size="6">
                <ion-button expand="block" fill="outline" (click)="cerrarModal()">Cancelar</ion-button>
              </ion-col>
              <ion-col size="6">
                <ion-button expand="block" type="submit" [disabled]="formCliente.invalid || guardando">
                  {{ guardando ? 'Guardando...' : 'Guardar' }}
                </ion-button>
              </ion-col>
            </ion-row>
          </form>
        </ion-content>
      </ng-template>
    </ion-modal>

    <!-- FAB para crear nuevo cliente (fuera del modal) -->
    <ion-fab vertical="bottom" horizontal="end" slot="fixed">
      <ion-fab-button [routerLink]="['/nuevo-cliente']">
        <ion-icon name="add"></ion-icon>
      </ion-fab-button>
    </ion-fab>
  </ion-content>
